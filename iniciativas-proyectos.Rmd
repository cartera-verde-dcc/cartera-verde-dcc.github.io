---
title: "Cartera verde de iniciativas y proyectos financiables alineados con la NDC de Costa Rica 2020"
output: 
  flexdashboard::flex_dashboard:
    theme: sandstone
    orientation: rows
runtime: shiny    
---

```{r setup, include=FALSE}
library(flexdashboard)
```

```{r paquetes}
library(dplyr)
library(tidyr)
library(stringr)
library(sf)
library(DT)
library(plotly)
library(leaflet)
library(leaflet.extras)
library(leafem)
```

```{r datos}
#
# Lectura de datos
#

# Lectura de la capa de cantones de Costa Rica
cantones <-
  st_read(
    "https://raw.githubusercontent.com/cartera-verde-dcc/cartera-verde-dcc.github.io/master/datos/cantones-simplificadas_100m.geojson",
    quiet = TRUE
  )
# Transformación del CRS del objeto cantones
cantones <-
  cantones %>%
  st_transform(4326)

# Lectura de la capa de regiones socioeconómicas de Costa Rica (publicadas por Mideplan)
regiones <-
  st_read(
    "https://raw.githubusercontent.com/cartera-verde-dcc/cartera-verde-dcc.github.io/master/datos/regiones-socioeconomicas-simplificadas_100m.geojson",
    quiet = TRUE
  )
# Transformación del CRS del objeto regiones
regiones <-
  regiones %>%
  st_transform(4326)

# Lectura de los datos de proyectos
proyectos <-
  st_read(
    "/vsicurl/https://raw.githubusercontent.com/cartera-verde-dcc/cartera-verde-dcc.github.io/master/datos/proyectos.csv",
    options = c("X_POSSIBLE_NAMES=c032",
                "Y_POSSIBLE_NAMES=c031"),
    quiet = TRUE
  )
# Asignación de CRS
st_crs(proyectos) <- 4326


#
# Limpieza de datos
#

# Selección y cambio de nombres de columnas de proyectos
proyectos <-
  proyectos %>%
  select(c005, c006, c007, c009, c010, c020, c028, c029, c031, c032, c040, c041, c042, c043, c044) %>%
  rename(nombre = c005) %>%
  rename(tipo_actor = c006) %>%
  rename(cedula = c007) %>%
  rename(telefono = c009) %>%
  rename(email = c010) %>%
  rename(web = c020) %>%
  rename(canton = c028) %>%
  rename(distrito = c029) %>%
  rename(latitud = c031) %>%
  rename(longitud = c032) %>%
  rename(regiones = c040) %>%
  rename(cantones = c041) %>%
  rename(tema_ac = c042) %>%
  rename(subtema_ac = c043) %>%
  rename(tipo_ac = c044)

# Limpieza de datos de proyectos
proyectos <-
  proyectos %>%
  filter(nombre != "") %>%
  mutate(cantones = str_replace_all(cantones, fixed("Perez Zeledón"), "Pérez Zeledón")) %>%
  mutate(cantones = str_replace_all(cantones, fixed("Talmanca"), "Talamanca")) %>%
  mutate(cantones = str_trim(cantones, side = "both")) %>%
  mutate(cantones = str_squish(cantones)) %>%
  mutate(cantones_comillas = str_replace_all(cantones, fixed(', '), '", "')) %>%
  mutate(regiones = str_replace_all(regiones, fixed("Región "), "")) %>%
  mutate(regiones = str_trim(regiones, side = "both")) %>%
  mutate(regiones = str_squish(regiones)) %>%
  mutate(regiones_comillas = str_replace_all(regiones, fixed(', '), '", "')) %>%
  mutate(tema_ac = str_replace_all(tema_ac, fixed("_"), " "))


#
# Joins de proyectos y cantones
#

# Data frame proyectos_cantones
proyectos_cantones <-
  proyectos %>%
  st_drop_geometry() %>%
  select(cedula, tipo_actor, tema_ac, subtema_ac, tipo_ac, cantones) %>%
  filter(cantones != "") %>%
  mutate(cantones = str_replace_all(cantones, fixed(", "), ",")) %>%
  mutate(cantones = strsplit(as.character(cantones), ",")) %>%
  unnest(cantones) %>%
  rename(canton = cantones)

# Data frame proyectos_cantones_conteo
proyectos_cantones_conteo <-
  proyectos_cantones %>%
  group_by(canton) %>%
  summarize(cantidad_proyectos = n())

# Join de cantones con proyecto_cantones_conteo
cantones <- left_join(cantones, proyectos_cantones_conteo)

# Reemplazo de NA
cantones <-
  cantones %>%
  mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))


#
# Joins de proyectos y regiones
#

# Data frame proyectos_regiones
proyectos_regiones <-
  proyectos %>%
  st_drop_geometry() %>%
  select(cedula, tipo_actor, tema_ac, subtema_ac, tipo_ac, regiones) %>%
  filter(regiones != "") %>%
  mutate(regiones = str_replace_all(regiones, fixed(", "), ",")) %>%
  mutate(regiones = strsplit(as.character(regiones), ",")) %>%
  unnest(regiones) %>%
  rename(region = regiones)

# Data frame proyectos_regiones_conteo
proyectos_regiones_conteo <-
  proyectos_regiones %>%
  group_by(region) %>%
  summarize(cantidad_proyectos = n())

# Join de cantones con proyecto_regiones_conteo
regiones <- left_join(regiones, proyectos_regiones_conteo)

# Reemplazo de NA
regiones <-
  regiones %>%
  mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))


# Listas de selección
# Lista ordenada de tipos de actor + "Todos"
lista_tipos_actores <- unique(proyectos$tipo_actor)
lista_tipos_actores <- sort(lista_tipos_actores)
lista_tipos_actores <- c("Todos", lista_tipos_actores)

# Lista ordenada de temas de acción climática + "Todos"
lista_temas_ac <- unique(proyectos$tema_ac)
lista_temas_ac <- sort(lista_temas_ac)
lista_temas_ac <- c("Todos", lista_temas_ac)

# Lista ordenada de subtemas de acción climática + "Todos"
lista_subtemas_ac <- unique(proyectos$subtema_ac)
lista_subtemas_ac <- sort(lista_subtemas_ac)
lista_subtemas_ac <- c("Todos", lista_subtemas_ac)

# Lista ordenada de tipos de acción climática + "Todos"
lista_tipos_ac <- unique(proyectos$tipo_ac)
lista_tipos_ac <- sort(lista_tipos_ac)
lista_tipos_ac <- c("Todos", lista_tipos_ac)

# Lista ordenada de cantones + "Todos"
lista_cantones <- unique(cantones$canton)
lista_cantones <- sort(lista_cantones)
lista_cantones <- c("Todos", lista_cantones)

# Lista ordenada de regiones + "Todas"
lista_regiones <- unique(regiones$region)
lista_regiones <- sort(lista_regiones)
lista_regiones <- c("Todas", lista_regiones)
```

Resumen
=======================================================================

Filtros {.sidebar}
-------------------------------------

```{r filtros}

h3("Filtros de datos")
p("Seleccione los criterios de acuerdo con los que desea filtrar los datos")

# Selector de tipo de actor
selectInput(
  inputId = "tipo_actor",
  label = "Tipo de actor",
  choices = lista_tipos_actores,
  selected = "Todos"
)

# Selector de tema de acción climática
selectInput(
  inputId = "tema_ac",
  label = "Tema de acción climática",
  choices = lista_temas_ac,
  selected = "Todos"
)

# Selector de subtema de acción climática
selectInput(
  inputId = "subtema_ac",
  label = "Subtema de acción climática",
  choices = lista_subtemas_ac,
  selected = "Todos"
)

# Selector de tipo de acción climática
selectInput(
  inputId = "tipo_ac",
  label = "Tipo de acción climática",
  choices = lista_tipos_ac,
  selected = "Todos"
)

# Selector de cantón
selectInput(
  inputId = "canton",
  label = "Cantón influenciado",
  choices = lista_cantones,
  selected = "Todos"
)

# Selector de región socioeconómica
selectInput(
  inputId = "region",
  label = "Región socioeconómica influenciada",
  choices = lista_regiones,
  selected = "Todas"
)

# Función para filtrar proyectos con base en los controles de entrada
filtrarProyectos <- reactive({
  proyectos_filtrados <- proyectos
  
  # Filtrado por tipo de actor
  if (input$tipo_actor != "Todos") {
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(tipo_actor == input$tipo_actor)
  }
  
  # Filtrado por tema de acción climática
  if (input$tema_ac != "Todos") {
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(tema_ac == input$tema_ac)
    
    if (input$subtema_ac == "Todos") {
      # HAY QUE ESTAR ATENTO PARA VER SI ESTE FILTRO DE SUBTEMAS FUNCIONA BIEN
      # CON ESTE CÓDIGO UBICADO SOLO AQUÍ O SI DEBE COLOCARSE EN OTRAS PARTES
      
      # Lista ordenada de subtemas de acción climática + "Todos"
      proyectos_tema_ac <- filter(proyectos, tema_ac == input$tema_ac)
      lista_subtemas_ac <- unique(proyectos_tema_ac$subtema_ac)
      lista_subtemas_ac <- sort(lista_subtemas_ac)
      lista_subtemas_ac <- c("Todos", lista_subtemas_ac)
      
      updateSelectInput(
        session,
        "subtema_ac",
        label = "Subtema de acción climática",
        choices = lista_subtemas_ac,
        selected = "Todos"
      )
    }
  }  
  
  # Filtrado por subtema de acción climática
  if (input$subtema_ac != "Todos") {
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(subtema_ac == input$subtema_ac)
  }    
  
  # Filtrado por tipo de acción climática
  if (input$tipo_ac != "Todos") {
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(tipo_ac == input$tipo_ac)
  }    
  
  # Filtrado por nombre de cantón
  if (input$canton != "Todos") {
    # Para evitar que las listas de cantones y regiones tengan valores seleccionados simultáneamente
    if (input$region != "Todas") {
      updateSelectInput(
        session,
        "region",
        label = "Región",
        choices = lista_regiones,
        selected = "Todas"
      )
    }
        
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(str_detect(
        paste0('"', cantones_comillas, '"'),
        paste0('"', input$canton, '"')
      ))
  }      
  
  # Filtrado por nombre de región socioeconómica
  if (input$region != "Todas") {
    # Para evitar que las listas de cantones y regiones tengan valores seleccionados simultáneamente
    if (input$canton != "Todos") {
      updateSelectInput(
        session,
        "canton",
        label = "Cantón",
        choices = lista_cantones,
        selected = "Todos"
      )
    }
    
    proyectos_filtrados <-
      proyectos_filtrados %>%
      filter(str_detect(
        paste0('"', regiones_comillas, '"'),
        paste0('"', input$region, '"')
      ))
  }        

  return(proyectos_filtrados)
})

# Función para filtrar cantones con base en los controles de entrada
filtrarCantones <- reactive({
  proyectos_cantones_filtrados <- proyectos_cantones
  cantones_filtrados <- cantones

  # Filtrado por tipo de actor
  if (input$tipo_actor != "Todos") {
    proyectos_cantones_filtrados <-
      proyectos_cantones_filtrados %>%
      filter(tipo_actor == input$tipo_actor)
    
    proyectos_cantones_conteo_filtrados <-
      proyectos_cantones_filtrados %>%
      group_by(canton) %>%
      summarize(cantidad_proyectos = n())
    
    cantones_filtrados <- 
      cantones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    cantones_filtrados <-
      left_join(cantones_filtrados, proyectos_cantones_conteo_filtrados)   

    cantones_filtrados <-
      cantones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }
  
  # Filtrado por tema de acción climática
  if (input$tema_ac != "Todos") {
    proyectos_cantones_filtrados <-
      proyectos_cantones_filtrados %>%
      filter(tema_ac == input$tema_ac)
    
    proyectos_cantones_conteo_filtrados <-
      proyectos_cantones_filtrados %>%
      group_by(canton) %>%
      summarize(cantidad_proyectos = n())
    
    cantones_filtrados <- 
      cantones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    cantones_filtrados <-
      left_join(cantones_filtrados, proyectos_cantones_conteo_filtrados)   

    cantones_filtrados <-
      cantones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }
  
  # Filtrado por subtema de acción climática
  if (input$subtema_ac != "Todos") {
    proyectos_cantones_filtrados <-
      proyectos_cantones_filtrados %>%
      filter(subtema_ac == input$subtema_ac)
    
    proyectos_cantones_conteo_filtrados <-
      proyectos_cantones_filtrados %>%
      group_by(canton) %>%
      summarize(cantidad_proyectos = n())
    
    cantones_filtrados <- 
      cantones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    cantones_filtrados <-
      left_join(cantones_filtrados, proyectos_cantones_conteo_filtrados)   

    cantones_filtrados <-
      cantones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }    
  
  # Filtrado por tipo de acción climática
  if (input$tipo_ac != "Todos") {
    proyectos_cantones_filtrados <-
      proyectos_cantones_filtrados %>%
      filter(tipo_ac == input$tipo_ac)
    
    proyectos_cantones_conteo_filtrados <-
      proyectos_cantones_filtrados %>%
      group_by(canton) %>%
      summarize(cantidad_proyectos = n())
    
    cantones_filtrados <- 
      cantones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    cantones_filtrados <-
      left_join(cantones_filtrados, proyectos_cantones_conteo_filtrados)   

    cantones_filtrados <-
      cantones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }  
  
  # Filtrado por nombre de cantón
  if (input$canton != "Todos") {
    proyectos_cantones_filtrados <-
      proyectos_cantones_filtrados %>%
      filter(canton == input$canton)
    
    proyectos_cantones_conteo_filtrados <-
      proyectos_cantones_filtrados %>%
      group_by(canton) %>%
      summarize(cantidad_proyectos = n())
    
    cantones_filtrados <- 
      cantones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    cantones_filtrados <-
      left_join(cantones_filtrados, proyectos_cantones_conteo_filtrados)   

    cantones_filtrados <-
      cantones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }    

  return(cantones_filtrados)
})

# Función para filtrar regiones con base en los controles de entrada
filtrarRegiones <- reactive({
  proyectos_regiones_filtrados <- proyectos_regiones
  regiones_filtrados <- regiones

  # Filtrado por tipo de actor
  if (input$tipo_actor != "Todos") {
    proyectos_regiones_filtrados <-
      proyectos_regiones_filtrados %>%
      filter(tipo_actor == input$tipo_actor)
    
    proyectos_regiones_conteo_filtrados <-
      proyectos_regiones_filtrados %>%
      group_by(region) %>%
      summarize(cantidad_proyectos = n())
    
    regiones_filtrados <- 
      regiones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    regiones_filtrados <-
      left_join(regiones_filtrados, proyectos_regiones_conteo_filtrados)   

    regiones_filtrados <-
      regiones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }
  
  # Filtrado por tema de acción climática
  if (input$tema_ac != "Todos") {
    proyectos_regiones_filtrados <-
      proyectos_regiones_filtrados %>%
      filter(tema_ac == input$tema_ac)
    
    proyectos_regiones_conteo_filtrados <-
      proyectos_regiones_filtrados %>%
      group_by(region) %>%
      summarize(cantidad_proyectos = n())
    
    regiones_filtrados <- 
      regiones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    regiones_filtrados <-
      left_join(regiones_filtrados, proyectos_regiones_conteo_filtrados)   

    regiones_filtrados <-
      regiones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }
  
  # Filtrado por subtema de acción climática
  if (input$subtema_ac != "Todos") {
    proyectos_regiones_filtrados <-
      proyectos_regiones_filtrados %>%
      filter(subtema_ac == input$subtema_ac)
    
    proyectos_regiones_conteo_filtrados <-
      proyectos_regiones_filtrados %>%
      group_by(region) %>%
      summarize(cantidad_proyectos = n())
    
    regiones_filtrados <- 
      regiones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    regiones_filtrados <-
      left_join(regiones_filtrados, proyectos_regiones_conteo_filtrados)   

    regiones_filtrados <-
      regiones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }    
  
  # Filtrado por tipo de acción climática
  if (input$tipo_ac != "Todos") {
    proyectos_regiones_filtrados <-
      proyectos_regiones_filtrados %>%
      filter(tipo_ac == input$tipo_ac)
    
    proyectos_regiones_conteo_filtrados <-
      proyectos_regiones_filtrados %>%
      group_by(region) %>%
      summarize(cantidad_proyectos = n())
    
    regiones_filtrados <- 
      regiones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    regiones_filtrados <-
      left_join(regiones_filtrados, proyectos_regiones_conteo_filtrados)   

    regiones_filtrados <-
      regiones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }
  
  # Filtrado por nombre de región socioeconómica
  if (input$region != "Todas") {
    proyectos_regiones_filtrados <-
      proyectos_regiones_filtrados %>%
      filter(region == input$region)
    
    proyectos_regiones_conteo_filtrados <-
      proyectos_regiones_filtrados %>%
      group_by(region) %>%
      summarize(cantidad_proyectos = n())
    
    regiones_filtrados <- 
      regiones_filtrados %>%
      select(-c(cantidad_proyectos))    
    
    regiones_filtrados <-
      left_join(regiones_filtrados, proyectos_regiones_conteo_filtrados)   

    regiones_filtrados <-
      regiones_filtrados %>%
      mutate(cantidad_proyectos = ifelse(is.na(cantidad_proyectos), 0, cantidad_proyectos))
  }    

  return(regiones_filtrados)
})
```

Row {data-height=750}
-----------------------------------------------------------------------

### Mapa de cantones influenciados, regiones socioeconómicas influenciadas y oficinas centrales de las iniciativas y proyectos

```{r mapa-resumen}
renderLeaflet({
  proyectos <- filtrarProyectos()
  cantones <- filtrarCantones()
  regiones <- filtrarRegiones()
  
  pal_cantidad_proyectos_cantones <-
    colorNumeric(palette = "YlGnBu", domain = cantones$cantidad_proyectos)
  pal_cantidad_proyectos_regiones <-
    colorNumeric(palette = "YlOrRd", domain = regiones$cantidad_proyectos)
  
  m <-
    leaflet() %>%
    setView(lng = -83.79452, # el centro está en -84.19452
            lat = 9.572735,
            zoom = 8) %>%
    addTiles(group = "OpenStreetMap") %>%
    addProviderTiles(providers$Stamen.TonerLite, group = "Stamen Toner Lite") %>%
    addProviderTiles(providers$CartoDB.DarkMatter, group = "CartoDB Dark Matter") %>%
    addProviderTiles(providers$Esri.WorldImagery, group = "Imágenes de ESRI")
  
  if (input$region == "Todas") {
    m <-
      m %>%
      addPolygons(
        data = cantones,
        group = "Grado de influencia de iniciativas por cantón",
        color = "black",
        stroke = TRUE,
        weight = 1.0,
        fillColor = ~ pal_cantidad_proyectos_cantones(cantidad_proyectos),
        fillOpacity = 0.8,
        popup = paste0(
          "<strong>Cantón: </strong>",
          cantones$canton,
          "<br>",
          "<strong>Cantidad de proyectos con influencia: </strong>",
          cantones$cantidad_proyectos
        )
      ) %>%
      addLegend(
        position = "bottomright",
        pal = pal_cantidad_proyectos_cantones,
        values = cantones$cantidad_proyectos,
        labFormat = labelFormat(digits = 0),
        group = "Grado de influencia de iniciativas por cantón",
        title = "Grado de influencia de iniciativas por cantón"
      )
  }
  
  if (input$canton == "Todos") {
    m <-
      m %>%
      addPolygons(
        data = regiones,
        group = "Grado de influencia de iniciativas por región SE",
        color = "black",
        stroke = TRUE,
        weight = 1.0,
        fillColor = ~ pal_cantidad_proyectos_regiones(cantidad_proyectos),
        fillOpacity = 0.8,
        popup = paste0(
          "<strong>Región SE: </strong>",
          regiones$region,
          "<br>",
          "<strong>Cantidad de proyectos con influencia: </strong>",
          regiones$cantidad_proyectos
        )
      ) %>%
      addLegend(
        position = "bottomleft",
        pal = pal_cantidad_proyectos_regiones,
        values = regiones$cantidad_proyectos,
        labFormat = labelFormat(digits = 0),
        group = "Grado de influencia de iniciativas por región SE",
        title = "Grado de influencia de iniciativas por región SE"
      )
  }
  
  m <-
    m %>%
    addCircleMarkers(
      data = proyectos,
      group = "Oficinas centrales de cada iniciativa o proyecto",
      fillColor = 'red',
      fillOpacity = 1,
      stroke = TRUE,
      radius = 4,
      popup = paste0(
        "<strong>Proyecto o iniciativa: </strong>",
        ifelse(
          proyectos$web == "N/A",
          proyectos$nombre,
          paste0('<a target=_blank href="', proyectos$web, '">', proyectos$nombre, "</a>")
        ),
        "<br>",
        "<strong>Tipo de actor: </strong>",
        proyectos$tipo_actor,
        "<br>",
        "<strong>Teléfono: </strong>",
        proyectos$telefono,
        "<br>",        
        "<strong>Correo electrónico: </strong>",
        proyectos$email,
        "<br>",        
        "<strong>Cantón de las oficinas centrales: </strong>",
        proyectos$canton,
        "<br>",        
        "<strong>Distrito de las oficinas centrales: </strong>",
        proyectos$distrito,
        "<br>",        
        "<strong>Tema de acción climática: </strong>",
        proyectos$tema_ac,
        "<br>",
        "<strong>Subtema de acción climática: </strong>",
        proyectos$subtema_ac,
        "<br>",
        "<strong>Tipo de acción climática: </strong>",
        proyectos$tipo_ac,
        ifelse(
          proyectos$cantones != "",
          paste0(
            "<br><strong>Cantones influenciados: </strong>",
            proyectos$cantones
          ),
          ""
        ),
        ifelse(
          proyectos$regiones != "",
          paste0(
            "<br><strong>Regiones socioeconómicas influenciadas: </strong>",
            proyectos$regiones
          ),
          ""
        )
      )
    ) %>%
    addLayersControl(
      baseGroups = c(
        "OpenStreetMap",
        "Stamen Toner Lite",
        "CartoDB Dark Matter",
        "Imágenes de ESRI"
      ),
      overlayGroups = c(
        ifelse(input$region == "Todas", "Grado de influencia de iniciativas por cantón", ""),
        ifelse(input$canton == "Todos", "Grado de influencia de iniciativas por región SE", ""),
        "Oficinas centrales de cada iniciativa o proyecto"
      )
    ) %>%
    addScaleBar(position = "bottomleft",
                options = scaleBarOptions(imperial = FALSE)) %>%
    addMouseCoordinates() %>%
    addSearchOSM() %>%
    addResetMapButton()
  
  if (input$canton == "Todos" & input$region == "Todas") {
    m <-
      m %>%
      hideGroup("Grado de influencia de iniciativas por región SE")
  }
  
  m
})
```

### Tabla de iniciativas y proyectos

```{r tabla-resumen}
renderDT({
  proyectos <- filtrarProyectos()
  
  proyectos %>%
    st_drop_geometry() %>%
    select(nombre, tipo_actor, tema_ac, subtema_ac, tipo_ac, cantones, regiones) %>%
    datatable(
      rownames = FALSE,
      colnames = c(
        "Iniciativa o proyecto",
        "Tipo de actor",
        "Tema de AC",
        "Subtema de AC",
        "Tipo de AC",
        "Cantones influenciados",
        "Regiones SE influenciadas"
      ),
      extensions = c("Buttons"),
      options = list(
        pageLength = 5,
        searchHighlight = TRUE,
        lengthMenu = list(c(5, 10, 15, 25, 50, 100,-1), c(5, 10, 15, 25, 50, 100, "Todos")),
        dom = 'Bfrtlip',
        language = list(url = "//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json"),
        buttons = list(
          list(extend = 'copy', text = 'Copiar'),
          list(extend = 'csv', text = 'CSV'),
          list(extend = 'csv', text = 'Excel'),
          list(extend = 'pdf', text = 'PDF')
        )
      )
    )
})  
```

Row {data-height=250}
-----------------------------------------------------------------------

### Gráfico del grado de influencia de iniciativas y proyectos por cantón {data-width=650}

```{r grafico-proyectos_x_canton-resumen}
renderPlotly({
  if (input$region == "Todas") {
    cantones <- filtrarCantones()
    
    cantones %>%
      st_drop_geometry() %>%
      filter(cantidad_proyectos >= 1) %>%
      top_n(n = 12, wt = cantidad_proyectos) %>%
      mutate(canton = factor(canton, levels = unique(canton)[order(cantidad_proyectos, decreasing = TRUE)])) %>%
      arrange(desc(cantidad_proyectos)) %>%
      plot_ly(
        x = ~ canton,
        y = ~ cantidad_proyectos,
        type = "bar",
        name = "Proyectos",
        text = ~ cantidad_proyectos,
        textposition = 'auto',
        marker = list(color = "#2c7fb8")
      ) %>%
      layout(
        yaxis = list(title = "Cantidad de iniciativas y proyectos"),
        xaxis = list(title = "Cantones"),
        barmode = 'group',
        hovermode = "compare"
      ) %>%
      config(locale = 'es')
  }
})
```

### Gráfico del grado de influencia de iniciativas y proyectos por región socioeconómica {data-width=350}

```{r grafico-proyectos_x_region_socioeconomica-resumen}
renderPlotly({
  if (input$canton == "Todos") {
    regiones <- filtrarRegiones()
    
    regiones %>%
      st_drop_geometry() %>%
      filter(cantidad_proyectos >= 1) %>%
      mutate(region = factor(region, levels = unique(region)[order(cantidad_proyectos, decreasing = TRUE)])) %>%
      arrange(desc(cantidad_proyectos)) %>%
      plot_ly(
        x = ~ region,
        y = ~ cantidad_proyectos,
        type = "bar",
        name = "Proyectos",
        text = ~ cantidad_proyectos,
        textposition = 'auto',
        marker = list(color = "#f03b20")
      ) %>%
      layout(
        yaxis = list(title = "Cantidad de iniciativas y proyectos"),
        xaxis = list(title = "Regiones socioeconómicas"),
        barmode = 'group',
        hovermode = "compare"
      ) %>%
      config(locale = 'es')
  }
})
```


Mapa
=======================================================================

### Mapa de cantones influenciados, regiones socioeconómicas influenciadas y oficinas centrales de las iniciativas y proyectos

```{r mapa-detalle}
renderLeaflet({
  proyectos <- filtrarProyectos()
  cantones <- filtrarCantones()
  regiones <- filtrarRegiones()
  
  pal_cantidad_proyectos_cantones <-
    colorNumeric(palette = "YlGnBu", domain = cantones$cantidad_proyectos)
  pal_cantidad_proyectos_regiones <-
    colorNumeric(palette = "YlOrRd", domain = regiones$cantidad_proyectos)
  
  m <-
    leaflet() %>%
    setView(lng = -83.79452, # el centro está en -84.19452
            lat = 9.572735,
            zoom = 8) %>%
    addTiles(group = "OpenStreetMap") %>%
    addProviderTiles(providers$Stamen.TonerLite, group = "Stamen Toner Lite") %>%
    addProviderTiles(providers$CartoDB.DarkMatter, group = "CartoDB Dark Matter") %>%
    addProviderTiles(providers$Esri.WorldImagery, group = "Imágenes de ESRI")
  
  if (input$region == "Todas") {
    m <-
      m %>%
      addPolygons(
        data = cantones,
        group = "Grado de influencia de iniciativas por cantón",
        color = "black",
        stroke = TRUE,
        weight = 1.0,
        fillColor = ~ pal_cantidad_proyectos_cantones(cantidad_proyectos),
        fillOpacity = 0.8,
        popup = paste0(
          "<strong>Cantón: </strong>",
          cantones$canton,
          "<br>",
          "<strong>Cantidad de proyectos con influencia: </strong>",
          cantones$cantidad_proyectos
        )
      ) %>%
      addLegend(
        position = "bottomright",
        pal = pal_cantidad_proyectos_cantones,
        values = cantones$cantidad_proyectos,
        labFormat = labelFormat(digits = 0),
        group = "Grado de influencia de iniciativas por cantón",
        title = "Grado de influencia de iniciativas por cantón"
      )
  }
  
  if (input$canton == "Todos") {
    m <-
      m %>%
      addPolygons(
        data = regiones,
        group = "Grado de influencia de iniciativas por región SE",
        color = "black",
        stroke = TRUE,
        weight = 1.0,
        fillColor = ~ pal_cantidad_proyectos_regiones(cantidad_proyectos),
        fillOpacity = 0.8,
        popup = paste0(
          "<strong>Región SE: </strong>",
          regiones$region,
          "<br>",
          "<strong>Cantidad de proyectos con influencia: </strong>",
          regiones$cantidad_proyectos
        )
      ) %>%
      addLegend(
        position = "bottomleft",
        pal = pal_cantidad_proyectos_regiones,
        values = regiones$cantidad_proyectos,
        labFormat = labelFormat(digits = 0),
        group = "Grado de influencia de iniciativas por región SE",
        title = "Grado de influencia de iniciativas por región SE"
      )
  }
  
  m <-
    m %>%
    addCircleMarkers(
      data = proyectos,
      group = "Oficinas centrales de cada iniciativa o proyecto",
      fillColor = 'red',
      fillOpacity = 1,
      stroke = TRUE,
      radius = 4,
      popup = paste0(
        "<strong>Proyecto o iniciativa: </strong>",
        ifelse(
          proyectos$web == "N/A",
          proyectos$nombre,
          paste0('<a href="', proyectos$web, '">', proyectos$nombre, "</a>")
        ),
        "<br>",
        "<strong>Tipo de actor: </strong>",
        proyectos$tipo_actor,
        "<br>",
        "<strong>Teléfono: </strong>",
        proyectos$telefono,
        "<br>",        
        "<strong>Correo electrónico: </strong>",
        proyectos$email,
        "<br>",        
        "<strong>Cantón de las oficinas centrales: </strong>",
        proyectos$canton,
        "<br>",        
        "<strong>Distrito de las oficinas centrales: </strong>",
        proyectos$distrito,
        "<br>",        
        "<strong>Tema de acción climática: </strong>",
        proyectos$tema_ac,
        "<br>",
        "<strong>Subtema de acción climática: </strong>",
        proyectos$subtema_ac,
        "<br>",
        "<strong>Tipo de acción climática: </strong>",
        proyectos$tipo_ac,
        ifelse(
          proyectos$cantones != "",
          paste0(
            "<br><strong>Cantones influenciados: </strong>",
            proyectos$cantones
          ),
          ""
        ),
        ifelse(
          proyectos$regiones != "",
          paste0(
            "<br><strong>Regiones socioeconómicas influenciadas: </strong>",
            proyectos$regiones
          ),
          ""
        )
      )
    ) %>%
    addLayersControl(
      baseGroups = c(
        "OpenStreetMap",
        "Stamen Toner Lite",
        "CartoDB Dark Matter",
        "Imágenes de ESRI"
      ),
      overlayGroups = c(
        ifelse(input$region == "Todas", "Grado de influencia de iniciativas por cantón", ""),
        ifelse(input$canton == "Todos", "Grado de influencia de iniciativas por región SE", ""),
        "Oficinas centrales de cada iniciativa o proyecto"
      )
    ) %>%
    addScaleBar(position = "bottomleft",
                options = scaleBarOptions(imperial = FALSE)) %>%
    addMouseCoordinates() %>%
    addSearchOSM() %>%
    addResetMapButton()
  
  if (input$canton == "Todos" & input$region == "Todas") {
    m <-
      m %>%
      hideGroup("Grado de influencia de iniciativas por región SE")
  }
  
  m
})
```


Tabla
=======================================================================

### Tabla de iniciativas y proyectos

```{r tabla-detalle}
renderDT({
  proyectos <- filtrarProyectos()
  
  proyectos %>%
    st_drop_geometry() %>%
    select(
      nombre,
      tipo_actor,
      web,
      telefono,
      email,
      canton,
      distrito,
      tema_ac,
      subtema_ac,
      tipo_ac,
      cantones,
      regiones
    ) %>%
    datatable(
      rownames = FALSE,
      colnames = c(
        "Iniciativa o proyecto",
        "Tipo de actor",
        "Sitio web",
        "Teléfono",
        "Correo",
        "Cantón",
        "Distrito",
        "Tema de AC",
        "Subtema de AC",
        "Tipo de AC",
        "Cantones influenciados",
        "Regiones SE influenciadas"
      ),
      extensions = c("Buttons"),
      options = list(
        pageLength = 5,
        searchHighlight = TRUE,
        lengthMenu = list(c(5, 10, 15, 25, 50, 100, -1), c(5, 10, 15, 25, 50, 100, "Todos")),
        dom = 'Bfrtlip',
        language = list(url = "//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json"),
        buttons = list(
          list(extend = 'copy', text = 'Copiar'),
          list(extend = 'csv', text = 'CSV'),
          list(extend = 'csv', text = 'Excel'),
          list(extend = 'pdf', text = 'PDF')
        )
      )
    )
})  
```


Gráficos
=======================================================================

Row {data-height=500}
-----------------------------------------------------------------------

### Gráfico del grado de influencia de iniciativas y proyectos por cantón

```{r grafico-proyectos_x_canton-detalle}
renderPlotly({
  if (input$region == "Todas") {
    cantones <- filtrarCantones()
    
    cantones %>%
      st_drop_geometry() %>%
      filter(cantidad_proyectos >= 1) %>%
      top_n(n = 20, wt = cantidad_proyectos) %>%
      mutate(canton = factor(canton, levels = unique(canton)[order(cantidad_proyectos, decreasing = TRUE)])) %>%
      arrange(desc(cantidad_proyectos)) %>%
      plot_ly(
        x = ~ canton,
        y = ~ cantidad_proyectos,
        type = "bar",
        name = "Proyectos",
        text = ~ cantidad_proyectos,
        textposition = 'auto',
        marker = list(color = "#2c7fb8")
      ) %>%
      layout(
        yaxis = list(title = "Cantidad de iniciativas y proyectos"),
        xaxis = list(title = "Cantones"),
        barmode = 'group',
        hovermode = "compare"
      ) %>%
      config(locale = 'es')
  }
})
```

Row {data-height=500}
-----------------------------------------------------------------------

### Gráfico del grado de influencia de iniciativas y proyectos por región socioeconómica {data-width=400}

```{r grafico-proyectos_x_region_socioeconomica-detalle}
renderPlotly({
  if (input$canton == "Todos") {
    regiones <- filtrarRegiones()
    
    regiones %>%
      st_drop_geometry() %>%
      filter(cantidad_proyectos >= 1) %>%
      mutate(region = factor(region, levels = unique(region)[order(cantidad_proyectos, decreasing = TRUE)])) %>%
      arrange(desc(cantidad_proyectos)) %>%
      plot_ly(
        x = ~ region,
        y = ~ cantidad_proyectos,
        type = "bar",
        name = "Proyectos",
        text = ~ cantidad_proyectos,
        textposition = 'auto',
        marker = list(color = "#f03b20")
      ) %>%
      layout(
        yaxis = list(title = "Cantidad de iniciativas y proyectos"),
        xaxis = list(title = "Regiones socioeconómicas"),
        barmode = 'group',
        hovermode = "compare"
      ) %>%
      config(locale = 'es')
  }
})
```


Metodología
=======================================================================

```{r texto-metodologia}
h1("Metodología de la cartera verde", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("En julio del 2021, la organización Sostenible Por Naturaleza S.A. fue contratada para identificar y analizar una Cartera Verde de Proyectos Financiables alineados a las ambiciones climáticas de Costa Rica y que apoyen el logro de las metas plasmadas en la Contribución Nacionalmente Determinada (NDC) de Costa Rica actualizada en diciembre 2020. El equipo profesional incluyó una especialista en gestión de proyectos, un especialista en cambio climático, una economista especializada en banca, una especialista en género y poblaciones históricamente excluidas y un especialista en SIG para el diseño del mapa interactivo en línea.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("El equipo consultor realizó cuatro sesiones de revisión y análisis de los tres instrumentos de política climática en los que se enmarca la consultoría: La Política Nacional de Adaptación 2018-2030, el Plan Nacional de Descarbonización 2018-2050 y la NDC 2020. El objetivo principal de estas sesiones fue generar un acuerdo en cuanto a la forma en que se explicaría a los entrevistados de manera coloquial el propósito de estas políticas, así como las potenciales formas en que las iniciativas y proyectos generaban contribuciones en línea con ellas.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Se realizaron además cinco sesiones para definir las variables a considerar y posteriormente la formulación de las preguntas que permitirían capturar la información pertinente. Es importante destacar que cada uno de los expertos tuvo a cargo la formulación de las preguntas asociadas a temas específicos económicos y financieros, de cambio climático o para la inclusión de poblaciones históricamente excluidas.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Se diseñó y diseminó una “Convocatoria Cartera Verde Proyectos Financiables” abierta para personas interesadas en incorporarse en la base de datos, con un link para completar un formulario preliminar. La invitación a la convocatoria salió de la Dirección de Cambio Climático. Se recibieron 106 solicitudes, de las que se concretaron 94 entrevistas.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Adicionalmente, las personas especialistas del equipo identificaron y contactaron grupos y entidades que trabajan con poblaciones históricamente excluidas, con sectores productivos relevantes como agricultura, turismo, conservación y otros. De esa manera fue posible distribuir la información del proceso y solicitar recomendaciones de iniciativas que pudieran ser entrevistadas. Se estima que fueron contactados cerca de 300 actores por parte de las personas especialistas y se logró realizar entrevistas con cerca de 1/3 de ellas. Los contactos se hicieron por correo electrónico, mensajes de WhatsApp, mensajes de Messenger, y otros medios.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Las entrevistas tuvieron lugar entre el 6 de septiembre y el 6 de octubre de 2021 y tomaron entre 45 minutos y una hora. Estas se realizaron por llamada telefónica, llamada por WhatsApp, video llamada por diferentes plataformas como Zoom y excepcionalmente en forma presencial, dado el contexto de pandemia generado por el COVID-19. Cada persona especialista entrevistó cerca de 50 informantes de relevancia, para un total de 200 incluidos en la base de datos.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Como lineamientos específicos se acordó que, luego del saludo, se explicaría a la persona entrevistada el propósito y alcance de la Cartera de Proyectos Verdes alineados con la NDC, así como la indicación de que estaba en completa libertad de no responder a cualquier pregunta que le resultara incómoda o por cualquier otra razón, sin tener que ofrecer ninguna explicación. Esto es un protocolo internacional de respeto a las personas informantes en proceso de investigación clínica, social, o de otro tipo. Se acordó también que, una vez concluida la entrevista, se agradecería el tiempo y la disponibilidad.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Las personas integrantes del equipo consultor capturaron la información por medio de un formulario en línea utilizando Google Forms. Para cada persona entrevistada se abrió un formulario nuevo, lo que permitió la captura de datos e información de cada proyecto, acción o iniciativa. Una vez completado ese proceso, se generó un documento Excel que integra la base de datos completa con la información generada de todas las iniciativas entrevistas.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("En relación al mapa con el especialista en cambio climático y el especialista en SIG determinaron las características del mismo, que incluye un visor geoespacial que despliega la información de los proyectos e iniciativas de manera ordenada y permite filtrar los proyectos a partir de una serie de criterios básicos.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")
```

Filtro de datos
=======================================================================

```{r texto-filtrodatos}
h1("Filtro de datos", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("El mapa de iniciativas y proyectos climáticos cuenta con un buscador que le permite al usuario realizar búsquedas, seleccionando los criterios con los que se desean filtrar esos datos. A continuación, se explican las categorías incluidas.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Tipo de actor", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Los actores incluidos en la base de datos se clasifican en las siguientes categorías, por orden alfabético: 1) Micros, Pequeñas y Medianas Empresas (MIPYMES) que operan bajo la figura de persona jurídica, Municipalidades, Organizaciones de base Comunitaria (ObC) como asociaciones y cooperativas locales), Organizaciones No Gubernamentales (ONG), personas físicas (muchas de las cuales también son MIPYMES que operan bajo cédula física) y personas físicas o jurídicas formalmente registradas en el MAG como Pequeños y Medianos Productores Agropecuarios (PYMPAS).", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Tema de acción climática", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Cada iniciativa y proyecto se ha clasificado por tema de acción climática, según su actividad principal, por orden alfabético:", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("1) agropecuario y pesca, 2) bosques y biodiversidad terrestre, 3) comercio y servicios, 4) energía, 5) gestión de residuos, 6) industria, 7) infraestructura y construcción, 8) ordenamiento territorial, 9) recurso hídrico, 10) transporte, 11) transversal y 12) turismo.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Subtema de acción climática", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Estas listas son dependientes de los temas en la lista anterior. Cada tema se divide en uno o varios subtemas, según su naturaleza o actividad, por ejemplo:", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Transversal: 1) educación, capacitación y empoderamiento climático, 2) financiamiento y herramientas de mercado, 3) investigación, 4) planificación y gobernanza.
Turismo:  1) gastronomía, 2) hospedaje, 3)  parque temático, 4) tour operación.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Tipo de acción climática", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Las iniciativas y proyectos identificados se clasificaron como de mitigación, de adaptación, o de mitigación y adaptación. Es importante destacar que al hacer el cruce con los instrumentos de planificación, proyectos clasificados como de adaptación también aplicaron para algunos ejes del Plan Nacional de Descarbonización. Asimismo, proyectos clasificados como de mitigación aplicaron para algunos ejes de la Política Nacional de Adaptación. Esto pareciera indicar que una iniciativa originalmente concebida para descarbonización también puede generar adaptación y vice-versa.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Cantón influenciado", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Es importante tomar en cuenta que, cuando se selecciona un cantón, lo que se muestra es el grado de influencia de iniciativas por cantón, no el número de iniciativas que tienen su sede u oficina establecidas en dicho cantón. Por ejemplo, la Asociación Dejando Huella tiene su sede en el cantón de Santa Ana, pero desarrolla sus actividades con comunidades urbano marginales del cantón de San José, así como con comunidades rurales de los cantones de Golfito, Limón, Matina, Siquirres y Pococí.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

h3("Región socioeconómica influenciada (regiones de MIDEPLAN)", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("Al igual que en el rubro anterior, lo que se muestra es el grado de influencia de iniciativas por región, no el número de iniciativas que tienen su sede u oficina establecidas en dicha región.", style = "font-family: 'Georgia'; font-size: large; padding: 0px 40px 5px 40px;")
```

Cartera de Proyectos Verdes
=======================================================================

```{r texto-carteraverde}
h1("Cartera de Proyectos Verdes alineados con la NDC", style = "font-family: 'Georgia'; padding: 8px 40px;")

p("El Proyecto NDC Support Programme del PNUD, tiene como propósito desarrollar actividades que fortalezcan el proceso de implementación de la NDC de Costa Rica con un enfoque más social y género responsivo. Además, continúa el apoyo para implementar el marco de transparencia del Acuerdo de París, a través del Sistema Nacional de Métrica de Cambio Climático (SINAMECC).", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Asimismo, en el marco del Plan de inversiones del Plan Nacional de Descarbonización, se debe tener mayor claridad en las inversiones y necesidades de fortalecimiento institucional que deberá realizar el país para alcanzar las metas a corto, mediano y largo plazo. Dentro de este marco, el proyecto apoya al país en la definición de áreas claves de inversión de acuerdo a este proceso. Por otro lado, la Contribución Nacionalmente Determinada 2020 compromete a Costa Rica a tomar acciones alineadas con una trayectoria consistente con la meta global de limitar el aumento de la temperatura media mundial a 1.5 °C. Se espera que las acciones resultantes de las contribuciones planteadas aumenten la capacidad de adaptación del país, fortalezcan la resiliencia y reduzcan su vulnerabilidad al cambio climático.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Es por esto que la identificación de posibles proyectos alineados a las ambiciones climáticas del país es clave para la implementación de la agenda climática y lograrlo a través de una transición justa. Asimismo, es de suma importancia para la toma de decisiones conocer los encadenamientos productivos y los beneficios socioeconómicos de dichos proyectos, para apoyar la transición a una economía verde.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("Es bajo este marco que durante el segundo semestre del 2021, el PNUD y la Dirección de Cambio Climático solicitaron la asesoría técnica de un equipo consultor para la creación de una “Cartera de Proyectos Verdes alineados con la NDC de Costa Rica”.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("La misma está constituida por una base de datos que reúne proyectos e iniciativas financiables que reflejan un espectro amplio de actividades productivas y de conservación relacionadas con el cambio climático y que contribuyen con el desarrollo sostenible de Costa Rica. Se incluyen proyectos e iniciativas de MIPYMES, Organizaciones de base -Comunitaria (ObC), ONG, municipalidades, y otras. Los proyectos e iniciativas son de origen privado y/o ciudadanas. La cartera tiene una cobertura nacional por regiones de MIDEPLAN, con representación tanto urbana como rural.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p('La “Cartera de Proyectos Verdes alineados con la NDC" está acompañada por un análisis de mecanismos y fuentes de financiamiento disponibles que permitan su ejecución.  El fin es identificar las condiciones de las empresas, proyectos y personas encuestadas que atienden la gestión de recursos naturales y que enfrentan los impactos del cambio climático, en el contexto de las oportunidades de acceso al financiamiento.', style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")

p("La cartera también viene acompañada de un análisis transversal desde la perspectiva de los derechos humanos y de género, de manera que las personas, desde su diversidad, puedan beneficiarse de las políticas y programas económicos y sociales que apoyan los procesos de descarbonización y de adaptación al cambio climático.", style = "font-family: 'Georgia'; font-size: large; padding: 2px 40px;")